# Global configuration example

# 模型与业务数据（所有服务共享）
# 模型根目录（默认指向仓库内 models/，线上可改为挂载卷路径）
MODELS_DIR=./models

# SteadyDancer 主权重目录（BF16，默认在 MODELS_DIR 下）
# 如不设置，则默认使用 ${MODELS_DIR}/SteadyDancer-14B
STEADYDANCER_CKPT_DIR=

# SteadyDancer DFloat11 压缩权重（可选，但推荐在支持的 GPU 上启用）
# - 默认 DF11 目录为 <MODELS_DIR>/SteadyDancer-14B-df11（与 scripts/compress_steadydancer_dfloat11.py 输出一致）；
# - 若不显式设置 STEADYDANCER_USE_DF11，系统会在该目录存在时自动优先使用 DF11，否则回退到 BF16。
STEADYDANCER_DF11_DIR=

# DF11 推理开关与显存策略
# - STEADYDANCER_USE_DF11：显式开关；留空表示“按是否存在 DF11 目录自动选择”；
# - STEADYDANCER_DF11_CPU_OFFLOAD：1 表示权重常驻 CPU，仅在前向时按块解码到 GPU，适合显存较小的卡；
# - STEADYDANCER_DF11_DEVICE_MAP_AUTO：1 表示使用 Accelerate 的 device_map=\"auto\" 做多卡切分（实验性）。
STEADYDANCER_USE_DF11=
STEADYDANCER_DF11_CPU_OFFLOAD=1
STEADYDANCER_DF11_DEVICE_MAP_AUTO=0

# 运行时业务数据根目录（项目与 Job 的输入/输出文件等）
# - DATA_DIR：全局运行时数据根目录，仅用于临时缓存或本地调试，默认 <repo_root>/data
# - STEADYDANCER_DATA_DIR：可选，为 SteadyDancer 显式指定独立数据根；若留空，
#   代码会优先使用 DATA_DIR，其次回退到 <repo_root>/data。
DATA_DIR=./data
STEADYDANCER_DATA_DIR=

# 临时文件根目录（中间产物、解压缓存等，一般可清理）
# - 默认为 <data_root>/tmp，其中 data_root 按上述 DATA_DIR/STEADYDANCER_DATA_DIR 解析
STEADYDANCER_TMP_DIR=

# 对象存储（S3 / MinIO）配置
# - 所有持久化文件（用户上传、生成结果、数据集）默认存储在对象存储中；
# - 本地 DATA_DIR 仅作为临时中转与缓存目录。
S3_ENDPOINT=http://localhost:9000
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin
S3_BUCKET_NAME=steadydancer
# 可选：Region 与访问样式
S3_REGION=
S3_USE_SSL=0
S3_ADDRESSING_STYLE=path

# 数据库与缓存（默认使用 infra/docker-compose.dev.yml 中的服务）
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/steadydancer
REDIS_URL=redis://localhost:6379/0

# Celery 队列配置（API 与 Worker 共用）
CELERY_BROKER_URL=redis://localhost:6379/1
CELERY_RESULT_BACKEND=redis://localhost:6379/2

# HTTP API 访问控制
# - 可选：为 API 配置一个简单的全局 API Key
# - 设置后，所有 /projects/** 和 /steadydancer/** 请求都必须携带：
#   X-API-Key: ${STEADYDANCER_API_KEY}
# - 开发环境可留空表示关闭认证（不建议在公网环境关闭）
# - 推荐：将本变量只在仓库根 .env 中维护；
#   如需对单个 app 使用不同的 Key，可在对应 apps/<app_name>/.env 中覆盖同名变量。
STEADYDANCER_API_KEY=

# 数据库自动建表（仅开发环境建议开启）
# - 1 / true / yes 等表示在 API 启动时自动创建缺失的表；
# - 生产环境建议显式设为 0，并通过迁移脚本管理表结构。
STEADYDANCER_DB_AUTO_CREATE=1
